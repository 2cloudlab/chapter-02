# IAM policy module

This module will create 5 groups of policies, as shown below:

1. AWS managed policies
2. Custom managed policies
3. Trust policies for role
4. Assume role policies for group
5. Permissions policies for role

This module only provide policies in json format, so it will only pull policy resources from AWS Web Service.

All polices that attach to IAM Group can config with MFA, which can further protect the user account of AWS.

Trust policies and assume role policies can also be configed with MFA. Permissions policies are used for attaching to IAM role.

All policies can be classified into the following groups:

## AWS managed policies

Policies in this group are generated by retrieving AWS managed policies. The following policies are generated:

* **full_access:** a group with administrator permissions
* **billing:** a group with billing permissions

All policies in this group can be configed with MFA option using `var.should_require_mfa`.

## Custom managed policies

Policies in this group are defined by you.

## Trust policies for role

Policies in this group are mainly used by IAM role. These policies can be configed with MFA option. The following policies are generated:

* Assume role policy for **read_only_access**

## Assume role policies for group

Policies in this group are attached to IAM group. Each policy allow access in one account to other AWS accounts by assuming roles in those accounts. The number of policies is determined by `var.across_account_access_role_arns_by_group`.

## Permissions policies for role

Policies in this group are attached to IAM roles. Each policy is paired with each trust policy in **Trust policies for role** group. These policies are generated without MFA option. The following policies are generated:

* **read_only_access:** user who assumes the role attached by this policy only allow read-only access in the account containing the role

## How to use?

The best way to use this moudle is shown below:

```terraform
# main.tf

module "iam_policies" {
  # Make sure to replace <VERSION> in this URL with the latest iam_policies release
  source = "git@github.com:2cloudlab/module_security.git//modules/iam_policies?ref=<VERSION>"
  should_require_mfa       = true
  across_account_access_role_arns_by_group         = 
  {
      dev_account_read_only_access = [
          "arn:aws:iam::120699691161:role/read_only_access",
      ]
  }
}
```

 The code above will create all policies in groups **AWS managed policies** and **Custom managed policies**. Instead, a group called **dev_account_read_only_access** will be created, users in this group allow assume role named read_only_access in the account 120699691161. All policies are configed with MFA option.